# ุญู ูุดููุฉ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ - ุงูุฏููู ุงูููุงุฆู

## ๐ ุงููุดููุฉ:
ุงููุธุงู ูุนุทู ุฑุณุงูุฉ "ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ" ููู ูููุฉ ุงููุฑูุฑ ูุง ุชุชุญุฏุซ ูุนููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

## โ ุงูุญููู ุงููุชุงุญุฉ (ุงุฎุชุฑ ุฃุญุฏูุง):

---

### ุงูุญู ุงูุฃูู: ุงุณุชุฎุฏุงู Supabase Service Role Key (ุงูุฃูุถู) ๐

#### ุงูุฎุทูุฉ 1: ุงูุญุตูู ุนูู Service Role Key
1. ุงุฐูุจ ุฅูู [Supabase Dashboard](https://supabase.com/dashboard)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงูุชูู ุฅูู **Settings** โ **API**
4. ุงูุณุฎ `service_role` **secret** key (ููุณ public!)

#### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุงูููุชุงุญ ููุจูุฆุฉ
ุฃุถู ูุฐุง ุงูุณุทุฑ ุฅูู ููู `.env.local`:
```env
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

#### ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
```bash
# ุฃููู ุงูุชุทุจูู (Ctrl+C)
# ุซู ุดุบูู ูุฑุฉ ุฃุฎุฑู
npm run dev
```

---

### ุงูุญู ุงูุซุงูู: ุชุดุบูู SQL Function

#### ุงุฐูุจ ุฅูู Supabase SQL Editor ูุดุบู:
```sql
-- ุฅูุดุงุก extension ููุชุดููุฑ
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- ุฅูุดุงุก function ูุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
CREATE OR REPLACE FUNCTION update_user_password(user_email TEXT, new_password TEXT)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public, auth
AS $$
DECLARE
    user_record auth.users%ROWTYPE;
    encrypted_password TEXT;
BEGIN
    -- ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู
    SELECT * INTO user_record
    FROM auth.users
    WHERE email = user_email
    AND deleted_at IS NULL;
    
    -- ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู
    IF NOT FOUND THEN
        RAISE LOG 'User not found: %', user_email;
        RETURN FALSE;
    END IF;
    
    -- ุชุดููุฑ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
    encrypted_password := crypt(new_password, gen_salt('bf'));
    
    -- ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ูู ุฌุฏูู auth.users
    UPDATE auth.users
    SET 
        encrypted_password = encrypted_password,
        password_hash = encrypted_password,
        updated_at = NOW()
    WHERE id = user_record.id;
    
    -- ุชุณุฌูู ุงูุนูููุฉ
    RAISE LOG 'Password updated successfully for user: %', user_email;
    
    RETURN TRUE;
    
EXCEPTION
    WHEN OTHERS THEN
        RAISE LOG 'Error updating password for user %: %', user_email, SQLERRM;
        RETURN FALSE;
END;
$$;

-- ููุญ ุงูุตูุงุญูุงุช ุงููุงุฒูุฉ
GRANT EXECUTE ON FUNCTION update_user_password(TEXT, TEXT) TO authenticated;
GRANT EXECUTE ON FUNCTION update_user_password(TEXT, TEXT) TO anon;
```

---

### ุงูุญู ุงูุซุงูุซ: ุงุณุชุฎุฏุงู ูุธุงู Supabase ุงูุชูููุฏู

ุฅุฐุง ูุดูุช ุงูุญููู ุงูุณุงุจูุฉ:

1. **ุงุฐูุจ ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุงูุนุงุฏูุฉ**
2. **ุงููุฑ "ูู ูุณูุช ูููุฉ ุงููุฑูุฑุ"**
3. **ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู**
4. **ุชุญูู ูู ุจุฑูุฏู ุงูุฅููุชุฑููู ููุญุตูู ุนูู ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู**
5. **ุงููุฑ ุนูู ุงูุฑุงุจุท ูุงุชุจุน ุงูุชุนูููุงุช**

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู ุจุนุฏ ุงูุชุทุจูู:

### ุงูุฎุทูุฉ 1: ุทูุจ ููุฏ ุฅุนุงุฏุฉ ุชุนููู
1. ุงุฐูุจ ุฅูู "ูู ูุณูุช ูููุฉ ุงููุฑูุฑุ"
2. ุฃุฏุฎู ุงูุจุฑูุฏ: `aa659531@gmail.com` ุฃู `pormaxhd@gmail.com`
3. ุงููุฑ "ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู"

### ุงูุฎุทูุฉ 2: ุงูุนุซูุฑ ุนูู ุงูููุฏ
- ุงูุชุญ **Developer Tools (F12) โ Console**
- ุงุจุญุซ ุนู: `๐ฒ ููุฏ ุฌุฏูุฏ ุชู ุฅูุดุงุคู: 123456`

### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
1. ุฃุฏุฎู ุงูููุฏ ุงููููู ูู 6 ุฃุฑูุงู
2. ุงููุฑ "ุงูุชุญูู ูู ุงูุฑูุฒ"
3. ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ: `test123456`
4. ุฃูุฏ ูููุฉ ุงููุฑูุฑ
5. ุงููุฑ "ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ"

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุฌุงุญ
ูู Console ุณุชุธูุฑ:
```
๐ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู: admin_api
```
ุฃู:
```
๐ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู: sql_function
```

### ุงูุฎุทูุฉ 5: ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
2. ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ: `test123456`
4. ูุฌุจ ุฃู ุชูุฌุญ ุนูููุฉ ุชุณุฌูู ุงูุฏุฎูู

---

## ๐ ุฑุณุงุฆู ุงููุฌุงุญ ุงููุชููุนุฉ:

### ูู ุญุงูุฉ ูุฌุงุญ Admin API:
```
๐ง ูุญุงููุฉ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู Admin API...
โ ุชู ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู ูู auth: aa659531@gmail.com
โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู Admin API
๐งน ุชู ูุถุน ุนูุงูุฉ ุนูู ุงูููุฏ ููุณุชุฎุฏู
๐งน ุชู ุชูุธูู ุงูููุฏุงุช ุงููุฏููุฉ
๐ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู: admin_api
```

### ูู ุญุงูุฉ ูุฌุงุญ SQL Function:
```
๐ง ูุญุงููุฉ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู SQL function...
โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู SQL function
๐งน ุชู ูุถุน ุนูุงูุฉ ุนูู ุงูููุฏ ููุณุชุฎุฏู
๐งน ุชู ุชูุธูู ุงูููุฏุงุช ุงููุฏููุฉ
๐ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู: sql_function
```

---

## โ ุฑุณุงุฆู ุงูุฎุทุฃ ูุญููููุง:

### "ูุดู ูู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุฌููุน ุงูุทุฑู"
**ุงูุญู:**
- ุชุทุจูู ุฃุญุฏ ุงูุญููู ุฃุนูุงู (Service Role Key ุฃู SQL Function)
- ุฃู ุงุณุชุฎุฏุงู ูุธุงู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุชูููุฏู

### "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ูุณุฌู"
**ุงูุญู:**
- ุชุฃูุฏ ูู ุงูุชุณุฌูู ุฃููุงู ุฃู ุงุณุชุฎุฏุงู ุจุฑูุฏ ูุณุฌู ูุณุจูุงู

### "ุฎุทุฃ ูู JSON parsing"
**ุงูุญู:**
- ุชุฃูุฏ ูู ุชุดุบูู ุงูุชุทุจูู ุจุดูู ุตุญูุญ: `npm run dev`

---

## ๐ง ูููุทูุฑูู:

### ุฅุถุงูุฉ Service Role Key ูู Production:
```env
# Production .env
SUPABASE_SERVICE_ROLE_KEY=your_production_service_role_key
NEXT_PUBLIC_SUPABASE_URL=your_production_url
```

### ุชุญุฏูุซ Database ูู Production:
```sql
-- ุชุดุบูู SQL function ูู production database
-- ุงูุณุฎ ุงูููุฏ ูู "ุงูุญู ุงูุซุงูู" ุฃุนูุงู
```

---

## ๐ฏ ุงูุฎูุงุตุฉ:

1. **ููุญู ุงูุณุฑูุน**: ุงุณุชุฎุฏู Supabase Service Role Key
2. **ููุญู ุงููุณุชุฏุงู**: ุดุบู SQL Function
3. **ููุงุณุชุฎุฏุงู ุงูุนุงุฏู**: ุงุณุชุฎุฏู ูุธุงู ุฅุนุงุฏุฉ ุชุนููู ุงูุชูููุฏู

**ุฃู ูู ูุฐู ุงูุญููู ุณูุญู ุงููุดููุฉ ููุงุฆูุงู!** ๐

---

## ๐ ุงูุฏุนู ุงูููู:

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู Console ููุฃุฎุทุงุก
2. ุชุฃูุฏ ูู ุชุทุจูู ุฃุญุฏ ุงูุญููู ุจุงููุงูู
3. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู ุจุนุฏ ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุนูู ุจููุงุกุฉ!** โจ 